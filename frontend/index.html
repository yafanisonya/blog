<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>手写代码 | Fanison&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="Keep Learning, Keep Growing, Keep Succeeding">
    
    <link rel="preload" href="/blog/assets/css/0.styles.dab10465.css" as="style"><link rel="preload" href="/blog/assets/js/app.148e97d9.js" as="script"><link rel="preload" href="/blog/assets/js/2.54c8166e.js" as="script"><link rel="preload" href="/blog/assets/js/9.688589c1.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.4b8eb1aa.js"><link rel="prefetch" href="/blog/assets/js/11.7010f881.js"><link rel="prefetch" href="/blog/assets/js/12.82db1fc0.js"><link rel="prefetch" href="/blog/assets/js/13.68c588ab.js"><link rel="prefetch" href="/blog/assets/js/14.2449c10f.js"><link rel="prefetch" href="/blog/assets/js/15.585e091a.js"><link rel="prefetch" href="/blog/assets/js/16.89ae9827.js"><link rel="prefetch" href="/blog/assets/js/17.53815d8e.js"><link rel="prefetch" href="/blog/assets/js/18.f829032d.js"><link rel="prefetch" href="/blog/assets/js/19.7db81cc4.js"><link rel="prefetch" href="/blog/assets/js/20.e984b1a1.js"><link rel="prefetch" href="/blog/assets/js/21.3f7c7631.js"><link rel="prefetch" href="/blog/assets/js/22.a2cdb77c.js"><link rel="prefetch" href="/blog/assets/js/23.f431a037.js"><link rel="prefetch" href="/blog/assets/js/24.f0d54556.js"><link rel="prefetch" href="/blog/assets/js/25.440c7fb6.js"><link rel="prefetch" href="/blog/assets/js/26.52cda476.js"><link rel="prefetch" href="/blog/assets/js/27.5e39016f.js"><link rel="prefetch" href="/blog/assets/js/28.0ca3fcb8.js"><link rel="prefetch" href="/blog/assets/js/3.4a740b64.js"><link rel="prefetch" href="/blog/assets/js/4.70c13cc5.js"><link rel="prefetch" href="/blog/assets/js/5.7418e283.js"><link rel="prefetch" href="/blog/assets/js/6.7b1f2309.js"><link rel="prefetch" href="/blog/assets/js/7.2de44a20.js"><link rel="prefetch" href="/blog/assets/js/8.b762ef4e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.dab10465.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Fanison's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/frontend/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  前端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目总结" class="dropdown-title"><span class="title">项目总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="项目总结" class="mobile-dropdown-title"><span class="title">项目总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/project/" class="nav-link">
  Vue3 Wheel
</a></li><li class="dropdown-item"><!----> <a href="/blog/project/morney.html" class="nav-link">
  React Money
</a></li><li class="dropdown-item"><!----> <a href="https://yafanisonya.github.io/note/money/note.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue Money
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://yafanisonya.github.io/note/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  学习笔记
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/yafanisonya" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/frontend/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  前端
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目总结" class="dropdown-title"><span class="title">项目总结</span> <span class="arrow down"></span></button> <button type="button" aria-label="项目总结" class="mobile-dropdown-title"><span class="title">项目总结</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/project/" class="nav-link">
  Vue3 Wheel
</a></li><li class="dropdown-item"><!----> <a href="/blog/project/morney.html" class="nav-link">
  React Money
</a></li><li class="dropdown-item"><!----> <a href="https://yafanisonya.github.io/note/money/note.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue Money
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://yafanisonya.github.io/note/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  学习笔记
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/yafanisonya" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Home</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/blog/cv/" class="sidebar-link">简历</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/frontend/" aria-current="page" class="active sidebar-link">手写代码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frontend/#防抖与节流" class="sidebar-link">防抖与节流</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/#手写-ajax" class="sidebar-link">手写 AJAX</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/#深拷贝、浅拷贝" class="sidebar-link">深拷贝、浅拷贝</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/#数组去重" class="sidebar-link">数组去重</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/#数组扁平化" class="sidebar-link">数组扁平化</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/#promise" class="sidebar-link">Promise</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/#promise-all" class="sidebar-link">Promise.all</a></li><li class="sidebar-sub-header"><a href="/blog/frontend/#发布订阅" class="sidebar-link">发布订阅</a></li></ul></li><li><a href="/blog/frontend/fr002.html" class="sidebar-link">JS进阶</a></li><li><a href="/blog/frontend/fr003.html" class="sidebar-link">JS 基础</a></li><li><a href="/blog/frontend/fr004.html" class="sidebar-link">HTML、CSS、DOM</a></li><li><a href="/blog/frontend/typescript.html" class="sidebar-link">TypeScript</a></li><li><a href="/blog/frontend/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/blog/frontend/browser.html" class="sidebar-link">浏览器</a></li><li><a href="/blog/frontend/network.html" class="sidebar-link">网络</a></li><li><a href="/blog/frontend/safety.html" class="sidebar-link">安全</a></li><li><a href="/blog/frontend/vue.html" class="sidebar-link">Vue</a></li><li><a href="/blog/frontend/react.html" class="sidebar-link">React</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>深入浅出</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/new/" class="sidebar-link">小程序登录及封装</a></li><li><a href="/blog/new/new1.html" class="sidebar-link">服务端渲染</a></li><li><a href="/blog/new/new2.html" class="sidebar-link">函数式编程</a></li><li><a href="/blog/new/new3.html" class="sidebar-link">异步编程</a></li><li><a href="/blog/new/new4.html" class="sidebar-link">TypeScript</a></li><li><a href="/blog/new/new5.html" class="sidebar-link">Vuex 状态管理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>项目总结</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/project/" class="sidebar-link">Vue3 Wheel</a></li><li><a href="/blog/project/morney.html" class="sidebar-link">React Money</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>知识点补充</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/question/" class="sidebar-link">Vue 补充</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="防抖与节流"><a href="#防抖与节流" class="header-anchor">#</a> 防抖与节流</h2> <h3 id="防抖-debounce"><a href="#防抖-debounce" class="header-anchor">#</a> 防抖 (debounce)</h3> <p>将多次高频操作优化为只在最后一次执行
使用场景：用户输入，只需在输入完成后做一次输入校验即可</p> <div class="language- extra-class"><pre class="language-text"><code> function debounce(fn, delay){
     let timerId = null
     return function(){
         const context = this
         if(timerId){window.clearTimeout(timerId)}
         timerId = setTimeout(()=&gt;{
             fn.apply(context, arguments)
             timerId = null
         },delay)
     }
 }
 const debounced = debounce(()=&gt;console.log('hi'))
 debounced()
 debounced()
</code></pre></div><h3 id="节流-throttle"><a href="#节流-throttle" class="header-anchor">#</a> 节流(throttle):</h3> <p>每隔一段时间后执行一次
使用场景: 滚动条事件 或者 resize 事件，通常每隔 100~500 ms 执行一次即可。</p> <div class="language- extra-class"><pre class="language-text"><code>function throttle(fn, delay){
     let canUse = true
     return function(){
         if(canUse){
             fn.apply(this, arguments)
             canUse = false
             setTimeout(()=&gt;canUse = true, delay)
         }
     }
 }

 const throttled = throttle(()=&gt;console.log('hi'))
 throttled()
 throttled()
</code></pre></div><h2 id="手写-ajax"><a href="#手写-ajax" class="header-anchor">#</a> 手写 AJAX</h2> <p>ajax 是一种异步通信的方法,从服务端获取数据,达到局部刷新页面的效果。</p> <ul><li>创建 XMLHttpRequest 对象</li> <li>调用 open 方法传入三个参数 请求方式(GET/POST)、url、同步异步(true/false)</li> <li>监听 onreadystatechange 事件，当 readystate 等于 4 时返回 responseText</li> <li>调用 send 方法传递参数</li></ul> <div class="language- extra-class"><pre class="language-text"><code>const ajax = (method, url, data, success, fail) =&gt; {
  var request = new XMLHttpRequest()
  request.open(method, url);
  request.onreadystatechange = function () {
    if(request.readyState === 4) {
      if(request.status &gt;= 200 &amp;&amp; request.status &lt; 300 || request.status === 304) {
        success(request)
      }else{
        fail(request)
      }
    }
  };
  request.send();
}
</code></pre></div><h2 id="深拷贝、浅拷贝"><a href="#深拷贝、浅拷贝" class="header-anchor">#</a> 深拷贝、浅拷贝</h2> <h3 id="浅拷贝"><a href="#浅拷贝" class="header-anchor">#</a> 浅拷贝</h3> <p>以赋值的形式拷贝引用对象，仍指向同一个地址，修改时原对象也会受到影响</p> <ul><li>Object.assign</li> <li>展开运算符(...)</li></ul> <div class="language- extra-class"><pre class="language-text"><code>function shallowClone(obj){
  let cloneObj = {};
  for(let i in obj){
    cloneObj[i] = obj[i]
  }
  return cloneObj
}
</code></pre></div><h3 id="深拷贝"><a href="#深拷贝" class="header-anchor">#</a> 深拷贝</h3> <p>完全拷贝一个新对象，修改时原对象不再受到任何影响</p> <ul><li>JSON.parse(JSON.stringify(obj)): 性能最快
<ul><li>具有循环引用的对象时，报错</li> <li>当值为函数、undefined、或 symbol 时，无法拷贝</li></ul></li> <li>递归进行逐一赋值</li></ul> <div class="language- extra-class"><pre class="language-text"><code>function deepClone(obj){
  if( obj === null ){ return null}
  if( obj instanceof RegExp ){ return new RegExp(obj)}
  if( obj instanceof Date ){ return new Date(obj)}

  if( typeof obj === 'object'){
    var result = Array.isArray(obj) ? [] : {}
    for(var i in obj){
      result[i] = typeof obj[i] === 'object' ? deepClone(obj[i] : obj[i])
    }
  } else{
    var result = obj
  }
  rerturn result
}
</code></pre></div><h2 id="数组去重"><a href="#数组去重" class="header-anchor">#</a> 数组去重</h2> <ul><li>使用 Set</li> <li>利用 for 嵌套 for，然后 splice 去重</li> <li>利用 indexOf 去重</li> <li>利用 includes</li> <li>利用 sort()</li> <li>利用 filter</li> <li>利用 hasOwnProperty</li> <li>使用 WeakMap</li></ul> <div class="language- extra-class"><pre class="language-text"><code>[...new Set(arr)]

function unique (arr) {
  return Array.from(new Set(arr))
}

// fun2 :双层循环，外层循环元素，内层循环时比较值。值相同时，则删去这个值。
function unique (arr) {
  for (var i = 0; i &lt; arr.length; i++) {
    for (var j = i + 1; j &lt; arr.length; j++) {
      if (arr[i] == arr[j]) {
        arr.splice(j, 1);
        j--;
      }
    }
  } return arr;
}

// fun3: 新建一个空的结果数组，for 循环原数组，判断结果数组是否存在当前元素，如果有相同的值则跳过，不相同则push进数组。
function unique (arr) {
  var array = [];
  for (var i = 0; i &lt; arr.length; i++) {
    if (array.indexOf(arr[i]) === -1) {
      array.push(arr[i])
    }
  }
  return array;
}

// fun4：利用includes 检测数组是否有某个值
function unique (arr) {
  var array = [];
  for (var i = 0; i &lt; arr.length; i++) {
    if (!array.includes(arr[i])) {  /
      array.push(arr[i]);
    }
  }
  return array
}

// fun5: 利用sort()排序方法，然后根据排序后的结果进行遍历及相邻元素比对。
function unique (arr) {
  arr = arr.sort()
  var arrry = [arr[0]];
  for (var i = 1; i &lt; arr.length; i++) {
    if (arr[i] !== arr[i - 1]) {
      arrry.push(arr[i]);
    }
  }
  return arrry;
}

// fun6： 利用filter
function unique(arr) {
  return arr.filter(function(item, index, arr) {
    //当前元素，在原始数组中的第一个索引==当前索引值，否则返回当前元素
    return arr.indexOf(item, 0) === index;
  });
}

// fun7: 利用hasOwnProperty
function unique (arr) {
  var obj = {};
  return arr.filter(function (item, index, arr) {
    return obj.hasOwnProperty(typeof item + item) ? false : (obj[typeof item + item] = true)
  })
}

// fun8: 使用 WeakMap
 function unique(arr) {
  var map = new Map()
  for (let i = 0; i &lt; arr.length; i++) {
    let number = arr[i]
    if (number === undefined) { continue }
    if (map.has(number)) {
      continue
    }
    map.set(number, true)

  }
  return [...map.keys()]
}
</code></pre></div><h2 id="数组扁平化"><a href="#数组扁平化" class="header-anchor">#</a> 数组扁平化</h2> <ul><li>调用 ES6 中的 flat 方法</li> <li>利用 reduce 函数迭代</li> <li>扩展运算符</li> <li>普通递归</li></ul> <div class="language- extra-class"><pre class="language-text"><code>let ary = [1, [2, [3, [4, 5]]], 6];// -&gt; [1, 2, 3, 4, 5, 6]

// flat 方法
ary = ary.flat(Infinity);

// reduce()
function flatten (arr) {
  return arr.reduce((result, item) =&gt; {
    return result.concat(Array.isArray(item) ? flatten(item) : item);
  }, []);
}

//扩展运算符: 只要有一个元素有数组，那么循环继续
while (ary.some(Array.isArray)) {
  ary = [].concat(...ary);
}

// 普通递归
let result = [];
function flatten (ary) {
  for (let i = 0; i &lt; ary.length; i++) {
    let item = ary[i];
    if (Array.isArray(ary[i])) {
      fn(item);
    } else {
      result.push(item);
    }
  }
}
</code></pre></div><h2 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h2> <div class="language- extra-class"><pre class="language-text"><code>function myPromise(constructor){
  let self=this;
  self.status=&quot;pending&quot; //定义状态改变前的初始状态
  self.value=undefined;//定义状态为resolved的时候的状态
  self.reason=undefined;//定义状态为rejected的时候的状态

  function resolve(value){
    //两个===&quot;pending&quot;，保证了了状态的改变是不不可逆的
    if(self.status===&quot;pending&quot;){
      self.value=value;
      self.status=&quot;resolved&quot;;
    }
  }
  function reject(reason){
     //两个===&quot;pending&quot;，保证了了状态的改变是不不可逆的
     if(self.status===&quot;pending&quot;){
        self.reason=reason;
        self.status=&quot;rejected&quot;;
      }
  }
  //捕获构造异常
  try{
      constructor(resolve,reject);
  }catch(e){
    reject(e);
    } }

myPromise.prototype.then=function(onFullfilled,onRejected){
  let self=this;
  switch(self.status){
    case &quot;resolved&quot;: onFullfilled(self.value); break;
    case &quot;rejected&quot;: onRejected(self.reason); break;
    default:
  }
}
// 测试
var p=new myPromise(function(resolve,reject){resolve(1)});
p.then(function(x){console.log(x)})
</code></pre></div><h2 id="promise-all"><a href="#promise-all" class="header-anchor">#</a> Promise.all</h2> <div class="language- extra-class"><pre class="language-text"><code>Promise.prototype.myAll = function(promiseList) {
  return new Promise((resolve, reject) = &gt;{
    const resultList = []
    let count = 0
    promiseList.map((promise, index) = &gt;{
      promise.resolve(result = &gt;{
        resultList[index] = result count += 1
        if (count &gt;= promiseList.length) {
          resolve(resultList)
        }
      },
      (reason) = &gt;{
        reject(reason)
      })
    })
  })
}
</code></pre></div><h2 id="发布订阅"><a href="#发布订阅" class="header-anchor">#</a> 发布订阅</h2> <p><strong>实现思路</strong></p> <ul><li>创建一个 eventHub</li> <li>创建一个事件中心（Map）</li> <li>on 方法用来把函数 fn 都加到事件中心中（订阅者注册事件到调度中心）</li> <li>emit 方法取到 arguments 里第一个当做 event，根据 event 值去执行对应事件中心中的函数（发布者发布事件到调度中心，调度中心处理代码）</li> <li>off 方法可以根据 event 值取消订阅（取消订阅）</li></ul> <div class="language- extra-class"><pre class="language-text"><code>const eventHub = {
  map: {
    // click: [f1 , f2]
  },
  on: (name, fn)=&gt;{
    eventHub.map[name] = eventHub.map[name] || []
    eventHub.map[name].push(fn)
  },
  emit: (name, data)=&gt;{
    const q = eventHub.map[name]
    if(!q) return
    q.map(f =&gt; f.call(null, data))
    return undefined
  },
  off: (name, fn)=&gt;{
    const q = eventHub.map[name]
    if(!q){ return }
    const index = q.indexOf(fn)
    if(index &lt; 0) { return }
    q.splice(index, 1)
  }
}

eventHub.on('click', console.log)
eventHub.on('click', console.error)

setTimeout(()=&gt;{
  eventHub.emit('click', 'frank')
},3000)
</code></pre></div><h3 id="使用-class"><a href="#使用-class" class="header-anchor">#</a> 使用 class</h3> <div class="language- extra-class"><pre class="language-text"><code>class EventHub {
  map = {}
  on(name, fn) {
    this.map[name] = this.map[name] || []
    this.map[name].push(fn)
  }
  emit(name, data) {
    const fnList = this.map[name] || []
    fnList.forEach(fn =&gt; fn.call(undefined, data))
  }
  off(name, fn) {
    const fnList = this.map[name] || []
    const index = fnList.indexOf(fn)
    if(index &lt; 0) return
    fnList.splice(index, 1)
  }
}
// 使用
const e = new EventHub()
e.on('click', (name)=&gt;{
  console.log('hi '+ name)
})
e.on('click', (name)=&gt;{
  console.log('hello '+ name)
})
setTimeout(()=&gt;{
  e.emit('click', 'frank')
},3000)
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/cv/" class="prev">
        简历
      </a></span> <span class="next"><a href="/blog/frontend/fr002.html">
        JS进阶
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.148e97d9.js" defer></script><script src="/blog/assets/js/2.54c8166e.js" defer></script><script src="/blog/assets/js/9.688589c1.js" defer></script>
  </body>
</html>
